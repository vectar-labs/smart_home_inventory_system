{% extends 'base.html' %} {% block content %}
<div class="w-full">
  <!-- Top header -->
  <div class="flex items-center justify-between p-4 bg-white rounded-md border border-gray-100">
    <div>
      <h2 class="text-xl font-semibold text-gray-700">Inventory</h2>
      <p class="text-sm text-slate-600 mt-2">Manage your inventory items here.</p>
    </div>
    <a
      href="{{url_for('main.add_item')}}"
      class="flex items-center gap-2 text-sm bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600 transition-colors cursor-pointer"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="18"
        height="18"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="lucide lucide-plus-icon lucide-plus"
      >
        <path d="M5 12h14" />
        <path d="M12 5v14" /></svg
      >Add Item
    </a>
  </div>
  <!-- Filters -->
  
  <form method="GET" action="{{ url_for('main.inventory') }}" class="w-full border border-gray-100 mt-5 p-4 bg-white rounded-md" x-data="{ showFilters: false }">
  <div class="flex items-center justify-between gap-4">
    <!-- Search input -->
    <div class="flex-grow flex items-center gap-4">
      <input
        type="text"
        name="search"
        value="{{ search or '' }}"
        placeholder="Search items..."
        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-sm"
      />
    </div>

    <button
      type="button"
      class="bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600 transition-colors text-sm flex items-center gap-2 cursor-pointer"
      x-on:click="showFilters = !showFilters"
    >
      <!-- icon -->
      Filters
    </button>
  </div>

  <!-- Filters panel -->
  <div
    class="w-full mt-4 gap-4"
    x-show="showFilters"
    x-transition:enter="transition ease-out duration-300"
    x-transition:enter-start="opacity-0"
    x-transition:enter-end="opacity-100"
  >
    <div class="grid grid-cols-3 gap-4">
      <!-- Category filter -->
      <div>
        <label class="block text-gray-600 mb-2 text-sm">Category</label>
        <select
          name="category_id"
          class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-xs"
        >
          <option value="">All Categories</option>
          {% for c in categories %}
            <option value="{{ c.id }}" {% if category_id == c.id %}selected{% endif %}>{{ c.name }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- Location filter -->
      <div>
        <label class="block text-gray-600 mb-2 text-sm">Storage Location</label>
        <select
          name="location_id"
          class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-xs"
        >
          <option value="">All Locations</option>
          {% for l in locations %}
            <option value="{{ l.id }}" {% if location_id == l.id %}selected{% endif %}>{{ l.name }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- Sort -->
      <div>
        <label class="block text-gray-600 mb-2 text-sm">Sort By</label>
        <select
          name="sort"
          class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-xs"
        >
          <option value="name" {% if sort == 'name' %}selected{% endif %}>Name</option>
          <option value="expiry" {% if sort == 'expiry' %}selected{% endif %}>Expire Date</option>
          <option value="quantity" {% if sort == 'quantity' %}selected{% endif %}>Quantity</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Submit button for filters -->
  <div class="mt-4 flex justify-end w-full">
    <button type="submit" class="w-full px-4 py-2.5 bg-gray-500 text-white text-sm rounded-md hover:bg-gray-600 cursor-pointer flex items-center justify-center gap-2">
      Apply
    </button>
  </div>
</form>


  <!-- Inventory Table -->
  <div class="mt-6 overflow-x-auto">
    <div class="w-full grid grid-cols-3 gap-4">
      {% for item in grocery_items %}
      <!-- Item card -->
      <div class="p-3 rounded-md border border-gray-200 bg-white">
        <div class="flex justify-between gap-2">
          <div>
            <h3 class="text-sm text-gray-700 mb-1 font-medium">{{ item.name }}</h3>
            <p class="text-xs text-gray-500">{{ item.category.name }}</p>
          </div>
          <span class="inline-flex items-center gap-x-1 py-1 px-3 rounded-lg text-xs font-medium bg-red-100 text-red-800"
            >{% if item.expiry_date %} {% set days_left = (item.expiry_date - today).days %} {% if days_left >= 0 %} {{ days_left }}d left {% else %} Expired {{
            -days_left }}d ago {% endif %} {% else %} No expiry {% endif %}
          </span>
        </div>
        <div class="pt-5 space-y-3">
          <p class="flex items-center space-x-1 text-sm text-gray-700 font-medium">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="lucide lucide-box-icon lucide-box"
            >
              <path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z" />
              <path d="m3.3 7 8.7 5 8.7-5" />
              <path d="M12 22V12" />
            </svg>
            <span>{{ item.quantity }} {{ item.unit.name }}</span>
          </p>
          <p class="flex items-center space-x-1 text-sm text-gray-700 font-medium">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="lucide lucide-map-pin-icon lucide-map-pin"
            >
              <path d="M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0" />
              <circle cx="12" cy="10" r="3" />
            </svg>
            <span>{{ item.location.name }}</span>
          </p>
          <p class="flex items-center space-x-1 text-sm text-gray-700 font-medium">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="lucide lucide-calendar-icon lucide-calendar"
            >
              <path d="M8 2v4" />
              <path d="M16 2v4" />
              <rect width="18" height="18" x="3" y="4" rx="2" />
              <path d="M3 10h18" />
            </svg>
            <span>Expires: {{ item.expiry_date.strftime('%d/%m/%Y') }}</span>
          </p>
        </div>
        <div>
          <div class="mt-4 py-1 flex justify-end gap-4 border-t border-gray-200">
            <a
              href="{{url_for('main.edit_item', item_id=item.id)}}"
              class="text-sm text-green-600 font-medium flex items-center py-1 px-3 gap-2 rounded-md hover:bg-green-100/50"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="lucide lucide-pencil-icon lucide-pencil"
              >
                <path d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z" />
                <path d="m15 5 4 4" /></svg
            ></a>

            <!-- Delete button  -->
            <form action="{{url_for('main.delete_grocery', item_id=item.id)}}" method="POST">
              <button type="submit" class="text-sm text-red-600 font-medium flex items-center py-1 px-3 gap-2 rounded-md hover:bg-red-100/50">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="lucide lucide-trash-icon lucide-trash"
                >
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6" />
                  <path d="M3 6h18" />
                  <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                </svg>
              </button>
            </form>
          </div>
        </div>
      </div>

      {% endfor %}
    </div>
  </div>
</div>
{% endblock content %}
