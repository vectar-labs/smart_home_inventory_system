{% extends 'base.html' %} {% block content %}
<div class="w-full">
  <!-- Top header -->
  <div class="flex items-center justify-between p-4">
    <div>
      <h2 class="text-xl font-semibold text-gray-700">Consumption Tracking</h2>
      <p class="text-sm text-slate-600 mt-2">Monitor and log grocery item usage</p>
    </div>
    <div class="flex items-center space-x-4">
      <a
        href="{{ url_for('main.download_consumption_excel') }}"
        class="flex items-center gap-2 text-sm text-gray-500 border border-gray-300 px-4 py-2 rounded-md cursor-pointer"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="lucide lucide-arrow-down-to-line-icon lucide-arrow-down-to-line text-gray-500"
        >
          <path d="M12 17V3" />
          <path d="m6 11 6 6 6-6" />
          <path d="M19 21H5" />
        </svg>
        Export</a
      ><a
        href="{{url_for('main.add_consumption')}}"
        class="flex items-center gap-2 text-sm bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600 transition-colors cursor-pointer"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="lucide lucide-plus-icon lucide-plus"
        >
          <path d="M5 12h14" />
          <path d="M12 5v14" /></svg
        >Log Consumption
      </a>
    </div>
  </div>
  <!-- statistics -->
  <div class="w-full grid grid-cols-1 md:grid-cols-3 gap-6">
    <!-- card -->
    <div class="col-span-1 bg-white border border-gray-200 rounded-md">
      <div class="p-6 rounded-md flex items-center justify-between">
        <div>
          <h3 class="text-md font-medium text-gray-600">Total Consumed Items</h3>
          <p class="text-lg font-semibold text-gray-700/50 mt-2">{{logs_count}}</p>
        </div>
        <div>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-chart-no-axes-column-icon lucide-chart-no-axes-column text-blue-400"
          >
            <path d="M5 21v-6" />
            <path d="M12 21V3" />
            <path d="M19 21V9" />
          </svg>
        </div>
      </div>
    </div>
    <!-- card -->
    <div class="col-span-1 bg-white border border-gray-200 rounded-md">
      <div class="p-6 rounded-md flex items-center justify-between">
        <div>
          <h3 class="text-md font-medium text-gray-600">This Week</h3>
          <p class="text-lg font-semibold text-gray-700/50 mt-2">{{weekly_logs_count}}</p>
        </div>
        <div>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-trending-down-icon lucide-trending-down text-green-400"
          >
            <path d="M16 17h6v-6" />
            <path d="m22 17-8.5-8.5-5 5L2 7" />
          </svg>
        </div>
      </div>
    </div>
    <!-- card -->
    <div class="col-span-1 bg-white border border-gray-200 rounded-md">
      <div class="p-6 rounded-md flex items-center justify-between">
        <div>
          <h3 class="text-md font-medium text-gray-600">Active Users</h3>
          <p class="text-lg font-semibold text-gray-700/50 mt-2">2</p>
        </div>
        <div>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-users-icon lucide-users text-indigo-400"
          >
            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
            <path d="M16 3.128a4 4 0 0 1 0 7.744" />
            <path d="M22 21v-2a4 4 0 0 0-3-3.87" />
            <circle cx="9" cy="7" r="4" />
          </svg>
        </div>
      </div>
    </div>
  </div>
  <!-- Filters -->
  <div class="w-full border border-gray-100 mt-5 p-4 bg-white rounded-md">
    <h2 class="flex items-center gap-3">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="lucide lucide-funnel-icon lucide-funnel"
      >
        <path
          d="M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z"
        /></svg
      ><span class="font-medium text-gray-600/80">Filters</span>
    </h2>

    <!-- Filters panel -->
    <div class="w-full mt-4 gap-4">
      <form class="grid grid-cols-1 md:grid-cols-4 gap-4" method="get">
  <!-- Search -->
  <div>
    <input
      type="text"
      name="q"
      placeholder="Search item or user..."
      value="{{ request.args.get('q', '') }}"
      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-sm"
    />
  </div>

  <!-- Category -->
  <div>
    <select
  name="item_category"
  class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-xs"
>
  <option value="">All Categories</option>
  {% for c in categories %}
    <option value="{{ c.name }}" {% if category_id == c.id %}selected{% endif %}>
      {{ c.name }}
    </option>
  {% endfor %}
</select>

  </div>

  <!-- Period -->
  <div>
    <select
      name="period"
      class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-xs"
    >
      <option value="" {% if not period %}selected{% endif %}>All time</option>
      <option value="today" {% if period == 'today' %}selected{% endif %}>Today</option>
      <option value="last7" {% if period == 'last7' %}selected{% endif %}>Last 7 days</option>
      <option value="last30" {% if period == 'last30' %}selected{% endif %}>Last 30 days</option>
    </select>
  </div>

  <!-- Submit -->
  <div>
    <input
      type="submit"
      value="Filter"
      class="w-full px-4 py-2 rounded-lg focus:outline-none bg-green-400 text-sm font-medium text-white cursor-pointer"
    />
  </div>
</form>

    </div>
  </div>

  <!-- Inventory Table -->
  <div class="overflow-x-auto border border-gray-100 mt-5 p-4 bg-white rounded-md">
    <div class="flex flex-col">
      <div class="-m-1.5 overflow-x-auto">
        <div class="p-1.5 min-w-full inline-block align-middle">
          <div class="overflow-hidden">
            <table class="min-w-full divide-y divide-gray-200 dark:divide-neutral-700">
              <thead>
                <tr>
                  <th scope="col" class="px-6 py-2 text-start text-xs font-medium text-gray-500 uppercase dark:text-neutral-500">DATE</th>
                  <th scope="col" class="px-6 py-2 text-start text-xs font-medium text-gray-500 uppercase dark:text-neutral-500">ITEM</th>
                  <th scope="col" class="px-6 py-2 text-start text-xs font-medium text-gray-500 uppercase dark:text-neutral-500">CATEGORY</th>
                  <th scope="col" class="px-6 py-2 text-start text-xs font-medium text-gray-500 uppercase dark:text-neutral-500">QUANTITY</th>
                  <th scope="col" class="px-6 py-2 text-start text-xs font-medium text-gray-500 uppercase dark:text-neutral-500">USER</th>
                  <th scope="col" class="px-6 py-2 text-end text-xs font-medium text-gray-500 uppercase dark:text-neutral-500">ACTIONS</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-200 dark:divide-neutral-700">
                {% for log in logs %}
                <tr>
                  <td class="px-6 py-4 text-sm font-medium text-gray-600 whitespace-nowrap flex items-center gap-2">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="18"
                      height="18"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      class="lucide lucide-calendar-icon lucide-calendar"
                    >
                      <path d="M8 2v4" />
                      <path d="M16 2v4" />
                      <rect width="18" height="18" x="3" y="4" rx="2" />
                      <path d="M3 10h18" /></svg
                    >{{ log.date.strftime('%d / %m / %Y') }}
                  </td>
                  <td class="px-6 py-4 text-sm text-gray-700 whitespace-nowrap">{{ log.grocery_item.name if log.grocery_item else log.item_name }}</td>
                  <td class="px-6 py-4 text-sm text-gray-700 whitespace-nowrap">
                    {{ log.grocery_item.category.name if log.grocery_item and log.grocery_item.category else log.item_category }}
                  </td>
                  <td class="px-6 py-4 text-sm text-gray-700 whitespace-nowrap">{{ log.qty_used }}</td>
                  <td class="px-6 py-4 text-sm text-gray-700 whitespace-nowrap">{{ log.user.username if log.user else 'Unknown user' }}</td>
                  <td class="px-6 py-4 text-sm font-medium text-right whitespace-nowrap">
                    <a href="#" class="text-red-600 hover:text-red-800">Remove</a>
                  </td>
                </tr>
                {% else %}
                <tr>
                  <td colspan="6" class="px-6 py-4 text-sm text-gray-700 text-center">No consumption logs found.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          <!-- Pagination -->
          <ul class="flex items-center justify-center gap-1 mt-4 text-sm">
            {# Prev button #} {% if pagination.has_prev %}
            <li>
              <a
                href="{{ url_for('main.consumption', page=pagination.prev_num) }}"
                class="inline-flex items-center px-3 py-1.5 rounded-md border border-gray-300 bg-white text-gray-700 hover:bg-gray-100 hover:text-gray-900"
              >
                Prev
              </a>
            </li>
            {% else %}
            <li>
              <span class="inline-flex items-center px-3 py-1.5 rounded-md border border-gray-200 bg-gray-100 text-gray-400 cursor-not-allowed"> Prev </span>
            </li>
            {% endif %} {# Page numbers #} {% for p in pagination.iter_pages() %} {% if p %} {% if p == pagination.page %}
            <li>
              <span class="inline-flex items-center px-3 py-1.5 rounded-md border border-green-500 bg-green-500 text-white"> {{ p }} </span>
            </li>
            {% else %}
            <li>
              <a
                href="{{ url_for('main.consumption', page=p) }}"
                class="inline-flex items-center px-3 py-1.5 rounded-md border border-gray-300 bg-white text-gray-700 hover:bg-gray-100 hover:text-gray-900"
              >
                {{ p }}
              </a>
            </li>
            {% endif %} {% else %}
            <li>
              <span class="inline-flex items-center px-2 py-1 text-gray-400">â€¦</span>
            </li>
            {% endif %} {% endfor %} {# Next button #} {% if pagination.has_next %}
            <li>
              <a
                href="{{ url_for('main.consumption', page=pagination.next_num) }}"
                class="inline-flex items-center px-3 py-1.5 rounded-md border border-gray-300 bg-white text-gray-700 hover:bg-gray-100 hover:text-gray-900"
              >
                Next
              </a>
            </li>
            {% else %}
            <li>
              <span class="inline-flex items-center px-3 py-1.5 rounded-md border border-gray-200 bg-gray-100 text-gray-400 cursor-not-allowed"> Next </span>
            </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock content%}
